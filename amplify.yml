version: 0.1
frontend:
  phases:
    preBuild:
      commands:
        # Install dependencies
        - npm install
    build:
      commands:
        # Build the main site
        - npm run build
        # Copy all built files
        - node copy-apps.js
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
  rewrites:
    - source: /
      target: /index.html
      status: 200
    - source: /set-list-drums/
      target: /set-list-drums/index.html
      status: 200
    - source: /pit-data/
      target: /pit-data/index.html
      status: 200
    - source: /set-list-drums/<*>
      target: /set-list-drums/index.html
      status: 200
    - source: /pit-data/<*>
      target: /pit-data/index.html
      status: 200
    - source: /<*>
      target: /index.html
      status: 200
  environment:
    variables:
      - NODE_ENV=production
      - GIT_LFS_SKIP_SMUDGE=1